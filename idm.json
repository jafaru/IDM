{
  "openapi": "3.0.1",
    "info": {
      "title": "Marketo Flow Lookup",
      "x-providerName": "Adobe Marketo Engage",
      "description": "This document describes the schema used by Marketo Self-Service Flow actions.  By implementing an API conforming to this interface, you can create custom flow actions for use in Marketo Smart Campaigns.  Title will be used to define the service name when ingested in Marketo, while x-providerName should be the name of the organization providing the service.  Use 'version' to indicate the version of your service, use 'x-schemaVersion' to indicate which version of the Service Provider Interface that your service implements.  'servers' may be set if the service host is different from the URL used to access your API definition, if unset the same host will be assumed, values after the first will be ignored.",
      "license": {
        "name": "MIT",
        "url": "/license"
      },
      "version": "0.3.0",
      "x-schemaVersion": "0.3.0",
      "x-supportPage": "https://developers.marketo.com",
      "x-supportContact": "jafarulla.s@verticurl.com"
    },
  "externalDocs": {
    "description": "Find out more about IDM",
    "url": "https://w3.ibm.com/w3publisher/individual-data-master"
  },
  "servers": [
    {
      "url": "https://idm-sub.968d96a4.public.multi-containers.ibm.com",
      "description":"Dev server"
    }, 
    {
      "url": "https://sub-test.968d96a4.public.multi-containers.ibm.com",
      "description":"Test server"
    },
    {
      "url": "http://localhost:8000",
      "description":"local server"
    }
  ],
  "tags": [
    {
      "name": "IDM",
      "description": "IDM suppress email API",
      "externalDocs": {
        "description": "Find out more",
        "url": "TBD"
      }
    }
  ],
  "paths": {
    "/getSubscriptions": {
      "post": {
        "tags": [
          "PrivPref"
        ],
        "summary": "get email privacy preference.",
        "operationId": "getsub",
        "requestBody": {
          "description": "send single email to get email privacy preference",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EMAIL"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Request been processed succeeds and MDM return success,  or api request has quarantined email",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/getSubResponse"
                }
              }
            }
          },
          "401": {
            "description": "Authentication/Authorization failure",
            "content": {}
          },
          "500": {
            "description": "Request can't be process right now. Contact IDM support team please.",
            "content": {}
          }
        },
        "security": [
          {
            "idm_bearer": []
          }
        ]
      }
    },
    "/updateSubscriptions": {
      "post": {
        "tags": [
          "PrivPref"
        ],
        "summary": "update email privacy preference.",
        "operationId": "updatesub",
        "requestBody": {
          "description": "send single email to get email privacy preference",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EMAIL_SUBSCRIPTION"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "msg": {
                      "type": "string",
                      "example": "Successful"
                    }
                  }
                }
              }
            }
          },
          "201": {
            "description": "Request fail when call MDM or fail when updating MIP tables.",
            "content": {}
          },
          "401": {
            "description": "Authentication/Authorization failure",
            "content": {}
          },
          "500": {
            "description": "Request can't be process right now. Contact IDM support team please.",
            "content": {}
          }
        },
        "security": [
          {
            "idm_bearer": []
        }
      ]
      }
    },
    "/suppressEmail": {
      "post": {
        "tags": [
          "PrivPref"
        ],
        "summary": "update email privacy preference.",
        "operationId": "suppressemail",
        "requestBody": {
          "description": "send emails to suppress it.",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/EMAIL_PRIVPREF"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Request been processed successfully",
            "content": {}
          },
          "201": {
            "description": "Request fail when call MDM or fail when updating MIP tables.",
            "content": {}
          },
          "401": {
            "description": "Authentication/Authorization failure",
            "content": {}
          },
          "500": {
            "description": "Request can't be process right now. Contact IDM support team please.",
            "content": {}
          }
        },
        "security": [
          {
            "idm_bearer": []
          }
        ]
      }
    },
  "/mktoSuppressEmail": {
    "post": {
      "tags": [
        "PrivPref"
      ],
      "summary": "update email privacy preference. For marketo only, use basic authentication. ",
      "operationId": "mktosuppressemail",
      "requestBody": {
        "description": "send email to suppress it. only email is the *required field.",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EMAIL_PRIVPREF"
            }
          }
        },
        "required": true
      },
      "responses": {
        "200": {
          "description": "Request been processed successfully",
          "content": {}
        },
        "201": {
          "description": "Request fail when call MDM or fail when updating MIP tables.",
          "content": {}
        },
        "401": {
          "description": "Authentication/Authorization failure",
          "content": {}
        },
        "500": {
          "description": "Request can't be process right now. Contact IDM support team please.",
          "content": {}
        }
      },
      "security": [
        {
          "idm_basic": []
        }
      ]
    }
  },
  "/getEmailPrivPref": {
    "post": {
      "tags": [
        "PrivPref"
      ],
      "summary": "get email privacy preference.",
      "operationId": "getIBMPrivPref",
      "requestBody": {
        "description": "send single email to get email privacy preference",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EMAIL"
            }
          }
        },
        "required": true
      },
      "responses": {
        "200": {
          "description": "Successful",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/getPrivPrefResponse"
              }
            }
          }
        },
        "401": {
          "description": "Authentication/Authorization failure",
          "content": {}
        },
        "500": {
          "description": "Request can't be process right now. Contact IDM support team please.",
          "content": {}
        }
      },
      "security": [
        {
          "idm_basic": []
        }
      ]
    }
  }
},
  "components": {
    "schemas": {
      "PRIVPREF": {
        "type": "object",
        "properties": {
          "SP_TYPE": {
            "type": "string",
            "description": "S = suppression, P = permission, N = not specified",
            "enum": [
              "S",
              "P",
              "N"
            ]
          },
          "SP_GRAN_PREF_TP": {
            "type": "string",
            "example": "IBM"
          }
        }
      },
      "PHONE_SP": {
        "type": "array",
        "xml": {
          "wrapped": true
        },
        "items": {
          "$ref": "#/components/schemas/PRIVPREF"
        }
      },
      "ADDR_SP": {
        "type": "array",
        "xml": {
          "wrapped": true
        },
        "items": {
          "$ref": "#/components/schemas/PRIVPREF"
        }
      },
      "EMAIL_ADDR_SP": {
        "type": "array",
        "xml": {
          "wrapped": true
        },
        "items": {
          "$ref": "#/components/schemas/PRIVPREF"
        }
      },
      "EMAIL": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "description": "email address use to fetch preference"
          }
        }
      },
      "getSubResponse": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "example": "john.doe@ibm.com"
          },
          "preferences": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": [
              "07xxxxx67bc39f2e",
              "07xxxxx67bc39f2f"
            ]
          }
        }
      },
      "getPrivPrefResponse": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "example": "john.doe@ibm.com"
          },
          "preferences": {
            "type": "string",
            "description":"S = suppression, P = permission, N = not specified",
            "example": "S"

          }
        }
      },
      "PrivPrefResp": {
        "type": "object",
        "properties": {
          "Error": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": [
              "input error: invalid email address"
            ]
          },
          "Response": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "PREF_CD": {
                  "type": "string",
                  "example": "IBM"
                },
                "PREF_DESCR": {
                  "type": "string",
                  "example": "IBM General Permission"
                },
                "PREF_EFF_TS": {
                  "type": "string",
                  "example": "2022-03-01T23:59:59"
                },
                "REF_NUM": {
                  "type": "string",
                  "example": "john.doe@ibm.com"
                },
                "SUPP_TYPE_CD": {
                  "type": "string",
                  "example": "P/S/N"
                }
              }
            }
          }
        }
      },
      "EMAIL_PRIVPREF": {
        "required": [
          "email"
        ],
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "example": "john.doe@ibm.com"
          },
          "origTransid": {
            "type": "string",
            "example": "trans000001"
          },
          "cmpn": {
            "type": "string",
            "example": "campaign 001"
          },
          "reason": {
            "type": "string",
            "example": "CR"
          },
          "timestamp": {
            "type": "string",
            "example": "2022-08-21T6:57:04Z"
          }
        }
      },
      "EMAIL_SUBSCRIPTION": {
        "required": [
          "email",
          "preferences",
          "source",
          "timestamp"
        ],
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "example": "john.doe@ibm.com"
          },
          "source": {
            "type": "string",
            "example": "Marketo"
          },
          "transid": {
            "type": "string",
            "example": "trans000001"
          },
          "cmpncode": {
            "type": "string",
            "example": "campaign 001"
          },
          "reasoncode": {
            "type": "string",
            "example": "CR"
          },
          "preferences": {
            "type": "object",
            "properties": {
              "07b3bea67bc39f2e": {
                "type": "string",
                "example": "P"
              },
              "07b3bea67bc39f2f": {
                "type": "string",
                "example": "P"
              }
            }
          },
          "timestamp": {
            "type": "string",
            "example": "2022-08-21T6:57:04Z"
          }
        }
      }
    },
    "securitySchemes": {
      "idm_bearer": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat":"JWT"
      },
      "idm_basic":{
        "type":"http",
        "scheme":"basic"
      },
      "idm_oauth": {
        "type": "oauth2",
        "flows": {
          "clientCredentials": {
            "tokenUrl": "https://eu-de.appid.cloud.ibm.com/oauth/v4/bcaefcc9-2d5c-48cd-b934-29d1e6f75e37/token",
            "scopes": {
            }
          }
        }
      }
    }
  }
}
